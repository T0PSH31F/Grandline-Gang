- name: Setup SSH
  env:
    SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
  run: |
    mkdir -p ~/.ssh
    echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_ed25519
    chmod 600 ~/.ssh/id_ed25519
    ssh-keyscan -H 192.168.8.212 >> ~/.ssh/known_hosts

- name: Deploy to luffy
  run: |
    nix run nixpkgs#nixos-rebuild -- switch \
      --flake .#luffy \
      --target-host root@192.168.8.212 \
      --use-remote-sudo
